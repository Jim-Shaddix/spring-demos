<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>whoami-table</title>
    <script type="text/javascript" src="js/TableFunctions.js"></script>
    <style>
        section {
            visibility: hidden;
        }
    </style>
</head>
<body>

    <h1>Whoami</h1>

    <div id="content">

        <div id="whoami-table">

            <section id="header-section">
                <h3>Request headers received from the servers</h3>
                <table id="header-table"></table>
            </section>

            <section id="request-body-section">
                <h3>Request Body</h3>
                <table id="request-body-table"></table>
            </section>

            <section id="url-parts-section">
                <h3>Url Parts</h3>
                <table id="url-parts-table"></table>
            </section>

            <section id="remote-info-section">
                <h3>Remote Info</h3>
                <table id="remote-info-table"></table>
            </section>

            <section id="authentication-section">
                <h3>Auth Info</h3>
                <table id="auth-info-table"></table>
            </section>

        </div>

    </div>

    <script th:inline="javascript">
        /*<![CDATA[*/
        const jsonBlob = /*[[${jsonBlob}]]*/ {
            "headers": [
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "host",
                    "value": "localhost:8080"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "connection",
                    "value": "keep-alive"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "sec-ch-ua",
                    "value": "\" Not A;Brand\";v=\"99\", \"Chromium\";v=\"99\", \"Google Chrome\";v=\"99\""
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "sec-ch-ua-mobile",
                    "value": "?0"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "sec-ch-ua-platform",
                    "value": "\"macOS\""
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "upgrade-insecure-requests",
                    "value": "1"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "user-agent",
                    "value": "Mozilla (Macintosh; Intel Mac ) Chrome"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "accept",
                    "value": "text/html,application/xhtml+xml"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "sec-fetch-site",
                    "value": "none"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "sec-fetch-mode",
                    "value": "navigate"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "sec-fetch-user",
                    "value": "?1"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "sec-fetch-dest",
                    "value": "document"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "accept-encoding",
                    "value": "gzip, deflate, br"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "accept-language",
                    "value": "en-US,en;q=0.9"
                },
                {
                    "type": null,
                    "short-definition": null,
                    "example": null,
                    "long-definition": null,
                    "name": "cookie",
                    "value": "idea-stuff"
                }
            ],
            "url-parts": {
                "definition": null,
                "request-method": "GET",
                "request-url": "http://localhost:8080/whoami",
                "scheme": "http",
                "protocol": "HTTP/1.1",
                "server-host": "localhost",
                "server-port": "8080",
                "path": "/whoami",
                "query-string": null
            },
            "remote-info": {
                "description": null,
                "definition": null,
                "request-address": "1.1",
                "request-host": "1.1",
                "request-port": "5777"
            },
            "auth": {
                "definition": null,
                "auth-type": null,
                "remoteUser": null,
                "user-principal": "null",
                "definitions": null
            },
            "body": {
                "definition": null,
                "content": "empty-body"
            },
            "server-info": {
                "definition": null,
                "hostname": "mac"
            }
        }/*]]>*/
    </script>

    <script th:inline="javascript">

        function setSectionTable(sectionSelector, fieldNames, jsonObject) {

            // set section element to visible
            let sectionElement = document.querySelector(sectionSelector)
            sectionElement.style.visibility = "visible";

            // populate the table in the section
            let tableElement = document.querySelector(sectionSelector + " " + "table")
            setTableTowsFromJsonWithoutFieldName(tableElement, fieldNames, jsonObject)

        }

        //setSectionTable("#header-section",        ["Header Name", "Value"],           jsonBlob["headers"])
        setSectionTable("#url-parts-section",     ["Url-Component", "Value"],         jsonBlob["url-parts"])
        setSectionTable("#request-body-section",  ["Request-Body-Component", "Value"],jsonBlob["body"])
        setSectionTable("#remote-info-section",   ["Client Info",  "Value"],          jsonBlob["remote-info"])
        setSectionTable("#authentication-section",["auth-info", "value"],             jsonBlob["auth"])

    </script>

</body>
</html>